<template>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 w-full pt-4 pb-8">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      
      <div v-if="farm" class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 h-fit">
        <h2 class="text-lg font-bold text-gray-800 mb-6 flex items-center gap-2">
          <span class="w-1 h-6 bg-[#F44323] rounded-full block"></span>
          ë†ì¥ ì •ë³´
        </h2>

        <div class="space-y-5">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">ë†ì¥ ìœ„ì¹˜</label>
            <div class="relative">
              <i class="fa-solid fa-location-dot absolute left-3 top-3.5 text-gray-400"></i>
              <div class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-700">
                {{ farm.location || '-' }}
              </div>
            </div>
          </div>

          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">ì£¼í’ˆëª©</label>
            <div class="relative">
              <i class="fa-solid fa-apple-whole absolute left-3 top-3.5 text-gray-400"></i>
              <div class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-700">
                {{ farm.mainCrop || '-' }}
              </div>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">ê²½ì‘ë©´ì </label>
              <div class="relative">
                <div class="w-full pl-4 pr-12 py-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-700">
                  {{ farm.cultivatedArea ? Number(farm.cultivatedArea).toLocaleString() : 0 }}
                </div>
                <span class="absolute right-4 top-3.5 text-gray-500 text-sm font-medium">ã¡</span>
              </div>
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">í‰ì§€ë©´ì </label>
              <div class="relative">
                <div class="w-full pl-4 pr-12 py-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-700">
                  {{ farm.flatArea ? Number(farm.flatArea).toLocaleString() : 0 }}
                </div>
                <span class="absolute right-4 top-3.5 text-gray-500 text-sm font-medium">ã¡</span>
              </div>
            </div>
          </div>

          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">ë†ì¥ ì¸ë ¥</label>
            <div class="flex items-center gap-4">
              <div class="w-10 h-10 rounded-full border border-gray-300 bg-gray-50 flex items-center justify-center text-gray-400">
                <i class="fa-solid fa-user"></i>
              </div>
              <span class="text-lg font-bold text-gray-800">{{ farm.manpower ?? 0 }}</span>
              <span class="text-gray-500">ëª…</span>
            </div>
          </div>

          <button
            @click="$emit('edit')"
            class="w-full bg-[#F44323] text-white font-bold py-4 rounded-lg shadow-md hover:bg-[#d63a1f] transform active:scale-[0.98] transition-all flex items-center justify-center gap-2"
          >
            <i class="fa-solid fa-pen-to-square"></i>
            ë†ì¥ ì •ë³´ ìˆ˜ì •í•˜ê¸°
          </button>
        </div>
      </div>

      <div v-else class="relative h-fit">
        <div class="blur-sm pointer-events-none select-none bg-white p-6 rounded-xl shadow-sm border border-gray-100 opacity-50">
          <h2 class="text-lg font-bold text-gray-800 mb-6 flex items-center gap-2">
            <span class="w-1 h-6 bg-[#F44323] rounded-full block"></span>
            ë†ì¥ ì •ë³´
          </h2>
          <div class="space-y-5">
             <div class="h-12 bg-gray-100 rounded-lg w-full"></div>
             <div class="h-12 bg-gray-100 rounded-lg w-full"></div>
             <div class="grid grid-cols-2 gap-5">
               <div class="h-12 bg-gray-100 rounded-lg w-full"></div>
               <div class="h-12 bg-gray-100 rounded-lg w-full"></div>
             </div>
          </div>
        </div>
        <div class="absolute inset-0 flex flex-col items-center justify-center rounded-xl z-10">
          <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center mb-4 shadow-sm border border-gray-100">
            <i class="fa-solid fa-tractor text-2xl text-gray-400"></i>
          </div>
          <p class="text-lg font-bold text-gray-700 mb-1">ë†ì¥ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤</p>
          <p class="text-sm text-gray-500 mb-5">ì •ë³´ë¥¼ ë“±ë¡í•˜ê³  AI ì§„ë‹¨ì„ ë°›ì•„ë³´ì„¸ìš”</p>
          <button
            @click="$emit('register')"
            class="bg-[#F44323] text-white font-bold px-6 py-3 rounded-lg shadow-md hover:bg-[#d63a1f] transition-all flex items-center gap-2"
          >
            <i class="fa-solid fa-plus"></i>
            ë†ì¥ ë“±ë¡í•˜ê¸°
          </button>
        </div>
      </div>

      <div v-if="farm && (farm.grade || farm.comment)" class="h-fit">
        
        <div class="bg-white p-6 pb-2 rounded-t-xl shadow-sm border border-gray-100 border-b-0 relative overflow-hidden z-10">
          <div class="absolute top-0 left-0 w-full h-2 bg-[#F44323]"></div>
          
          <div class="flex flex-col items-center justify-center pt-4">
            <p class="text-gray-500 font-medium mb-2 uppercase tracking-widest text-xs">Farm Grade</p>
            
            <div 
              :class="gradeCircleClass(farm.grade)"
              class="relative w-28 h-28 flex items-center justify-center rounded-full shadow-lg mb-3"
            >
              <span class="text-5xl font-black text-white drop-shadow-md">{{ farm.grade ?? '?' }}</span>
              <i class="fa-solid fa-star text-white text-lg absolute -top-1 -right-1"></i>
              <i class="fa-solid fa-star text-white text-lg absolute bottom-2 left-0"></i>
            </div>
            
            <h3 class="text-2xl font-bold text-gray-800">{{ gradeTitle(farm.grade) }}</h3>
            <p class="text-sm text-gray-400 mt-1">AIê°€ ë¶„ì„í•œ ë†ì¥ ì¢…í•© ë“±ê¸‰ì…ë‹ˆë‹¤</p>
          </div>
        </div>
        
        <div class="bg-white px-6 py-5 border-l border-r border-gray-100">
          
          <div class="w-full border-t border-dashed border-gray-200 mb-5"></div>

          <div class="flex flex-col">
            <p class="text-gray-400 font-bold mb-3 text-xs uppercase tracking-widest flex items-center gap-2">
              <i class="fa-solid fa-tag"></i> ë†ì¥ ìœ í˜• ë¶„ë¥˜
            </p>

            <div 
              class="rounded-xl p-4 border flex items-start gap-4 transition-all duration-300"
              :class="currentTypeConfig.color"
              :style="iconStyle"
            >
              <div 
                class="flex-shrink-0 w-12 h-12 rounded-lg flex items-center justify-center shadow-sm"
                :class="currentTypeConfig.iconBg"
              >
                <i class="fa-solid text-xl" :class="currentTypeConfig.icon"></i>
              </div>

              <div>
                <h4 class="font-bold text-base mb-1" :class="currentTypeConfig.textClass">
                  {{ currentTypeConfig.label }}
                </h4>
                <p class="text-sm opacity-90 leading-snug break-keep">
                  {{ currentTypeConfig.desc }}
                </p>
              </div>
            </div>
          </div>
        </div>

        <div class="bg-amber-50 p-6 rounded-b-xl border border-gray-200 border-t-gray-100">
          <div class="flex gap-4">
            <div class="flex-shrink-0">
              <div class="w-10 h-10 rounded-full bg-[#F44323] text-white flex items-center justify-center shadow-sm">
                <i class="fa-solid fa-robot"></i>
              </div>
            </div>
            <div class="bg-white p-4 rounded-2xl rounded-tl-none shadow-sm border border-gray-100 flex-1">
              <p class="text-gray-700 text-sm leading-relaxed">
                <span class="font-bold text-[#F44323] block mb-1">AI ë¶„ì„ ë¦¬í¬íŠ¸:</span> 
                {{ farm.comment ?? 'í‰ê°€ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.' }}
              </p>
            </div>
          </div>
        </div>

      </div>

      <div 
        v-else
        class="flex flex-col items-center justify-center text-center h-full min-h-[400px] border-2 border-dashed border-gray-200 rounded-xl bg-gray-50/50"
      >
        <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mb-4">
          <i class="fa-solid fa-clipboard-list text-3xl text-gray-300"></i>
        </div>
        <h3 class="text-lg font-bold text-gray-400">
          {{ !farm ? 'í‰ê°€ ëŒ€ê¸° ì¤‘' : 'ì•„ì§ í‰ê°€ê°€ ì—†ìŠµë‹ˆë‹¤' }}
        </h3>
        <p class="text-sm text-gray-400 max-w-xs mt-2 break-keep">
          {{ !farm ? 'ë†ì¥ì„ ë“±ë¡í•˜ë©´ AI ì§„ë‹¨ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.' : 'ë†ì¥ ì •ë³´ë¥¼ ì €ì¥í•˜ë©´ AIê°€ ìë™ìœ¼ë¡œ í‰ê°€ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.' }}
        </p>
      </div>

    </div>
  </div>
</template>

<script setup>
import { computed } from 'vue'

const props = defineProps({
  farm: {
    type: Object,
    default: null,
  },
});

defineEmits(['edit', 'register']);

// ë“±ê¸‰ ê´€ë ¨ ìƒ‰ìƒ
const gradeCircleClass = (grade) => {
  const map = {
    'A': 'bg-gradient-to-br from-[#F44323] to-orange-500',
    'B': 'bg-gradient-to-br from-blue-500 to-cyan-500',
    'C': 'bg-gradient-to-br from-yellow-400 to-yellow-600',
    'D': 'bg-gradient-to-br from-gray-400 to-gray-600',
  };
  return map[grade] || 'bg-gray-300';
};

const gradeTitle = (grade) => {
  const map = {
    'A': 'Excellent',
    'B': 'Good',
    'C': 'Average',
    'D': 'Bad',
  };
  return map[grade] || 'Unknown';
};

// ë†ì¥ ìœ í˜• ì •ì˜ - #F44323 ê¸°ë°˜ ìƒ‰ìƒ ì²´ê³„
const TYPE_DEFINITIONS = {
  // íš¨ìœ¨í˜•
  'Efficiency-Oriented': {
    label: 'íš¨ìœ¨í˜• ë†ì¥ (Efficiency)',
    desc: 'í‰ì§€ ë¹„ìœ¨ì´ ë†’ê³  ë…¸ë™ë ¥ í™œìš©ì´ íš¨ìœ¨ì ì¸ êµ¬ì¡°ì…ë‹ˆë‹¤.',
    icon: 'fa-chart-line',
    iconBg: 'bg-green-100',
    textClass: 'text-green-800',
    imageUrl: '@/assets/efficiency-oriented'
  },
  'íš¨ìœ¨í˜• ë†ì¥': 'Efficiency-Oriented',

  // ë…¸ë™ì§‘ì•½í˜• - ì˜¤ë Œì§€ (#F44323ê³¼ ìœ ì‚¬í•œ ê³„ì—´)
  'Labor-Intensive': {
    label: 'ë…¸ë™ì§‘ì•½í˜• ë†ì¥ (Labor)',
    desc: 'ì§€í˜•ì  ë¶ˆë¦¬í•¨ì„ ë†’ì€ ë…¸ë™ íˆ¬ì…ìœ¼ë¡œ ê·¹ë³µí•˜ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤.',
    icon: 'fa-users-gear',
    color: 'bg-orange-50 text-orange-700 border-orange-200',
    iconBg: 'bg-orange-100',
    textClass: 'text-orange-800'
  },
  'ë…¸ë™ì§‘ì•½í˜• ë†ì¥': 'Labor-Intensive',

  // ì§‘ì¤‘í˜• - ë¸”ë£¨ (ì§‘ì¤‘/ì „ë¬¸ì„±)
  'Focused': {
    label: 'ì§‘ì¤‘í˜• ë†ì¥ (Focused)',
    desc: 'íŠ¹ì • í•µì‹¬ ì‘ë¬¼ì— ì—­ëŸ‰ì„ ì§‘ì¤‘í•˜ëŠ” ì „ë¬¸í™”ëœ êµ¬ì¡°ì…ë‹ˆë‹¤.',
    icon: 'fa-bullseye',
    color: 'bg-blue-50 text-blue-700 border-blue-200',
    iconBg: 'bg-blue-100',
    textClass: 'text-blue-800'
  },
  'ì§‘ì¤‘í˜• ë†ì¥': 'Focused',

  // ì‹¤í—˜í˜• - í¼í”Œ (ì°½ì˜ì„±/ì‹¤í—˜)
  'Experimental': {
    label: 'ì‹¤í—˜í˜• ë†ì¥ (Experimental)',
    desc: 'ë¯¸ë˜ ë°©í–¥ì„±ì„ íƒìƒ‰í•˜ê¸° ìœ„í•´ ë‹¤í’ˆì¢… ì†ŒëŸ‰ ìƒì‚°ì„ ì‹œë„í•©ë‹ˆë‹¤.',
    icon: 'fa-flask',
    color: 'bg-purple-50 text-purple-700 border-purple-200',
    iconBg: 'bg-purple-100',
    textClass: 'text-purple-800'
  },
  'ì‹¤í—˜í˜• ë†ì¥': 'Experimental',

  // ë„ì‹œí˜• - ì‹œì•ˆ/í‹¸ (í˜„ëŒ€ì„±/ë„ì‹œ)
  'Urban': {
    label: 'ë„ì‹œí˜• ë†ì¥ (Urban)',
    desc: 'ë„ì‹¬ ì¸ê·¼ì— ìœ„ì¹˜í•˜ì—¬ ì ‘ê·¼ì„±ê³¼ ìœ í†µì— ê°•ì ì´ ìˆëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤.',
    icon: 'fa-city',
    color: 'bg-cyan-50 text-cyan-700 border-cyan-200',
    iconBg: 'bg-cyan-100',
    textClass: 'text-cyan-800'
  },
  'ë„ì‹œí˜• ë†ì¥': 'Urban',

  // ì „í†µí˜• - ì•°ë²„ (ì „í†µ/ì•ˆì •)
  'Traditional': {
    label: 'ì „í†µí˜• ë†ì¥ (Traditional)',
    desc: 'ì „ì²´ì ì¸ ìš´ì˜ êµ¬ì¡°ê°€ ê· í˜• ì¡í˜€ ìˆê³  ì•ˆì •ì ì¸ í˜•íƒœì…ë‹ˆë‹¤.',
    icon: 'fa-tractor',
    color: 'bg-amber-50 text-amber-700 border-amber-200',
    iconBg: 'bg-amber-100',
    textClass: 'text-amber-800'
  },
  'ì „í†µí˜• ë†ì¥': 'Traditional',

  // ê°œì„  í•„ìš” - ë ˆë“œ (#F44323 ë©”ì¸ ì»¬ëŸ¬ ê³„ì—´)
  'Needs Improvement': {
    label: 'ê°œì„  í•„ìš”í˜• (Needs Improv.)',
    desc: 'í˜„ì¬ ìš´ì˜ìƒ ë¶€ë‹´ì´ ìˆìœ¼ë‚˜, ëª…í™•í•œ ê°œì„  ì ì¬ë ¥ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.',
    icon: 'fa-hammer',
    color: 'bg-red-50 text-[#F44323] border-red-200',
    iconBg: 'bg-red-100',
    textClass: 'text-[#F44323]'
  },
  'ê°œì„  í•„ìš”í˜•': 'Needs Improvement'
};

const DEFAULT_TYPE_CONFIG = {
  label: 'ìœ í˜• ë¯¸ì§€ì •',
  desc: 'ì•„ì§ ë†ì¥ ìœ í˜•ì´ ë¶„ì„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.',
  icon: 'fa-circle-question',
  color: 'bg-gray-50 text-gray-600 border-gray-100',
  iconBg: 'bg-white',
  textClass: 'text-gray-700'
};

const currentTypeConfig = computed(() => ({
  iconBg: 'bg-emerald-500',           // ê¸°ì¡´ í”„ë ˆì„ ë°°ê²½
  imageUrl: '/images/farm.png',       // ë„£ê³  ì‹¶ì€ ì´ë¯¸ì§€
  label: 'ë†ì¥',
  fallbackText: 'ğŸŒ±',
}))

const iconStyle = computed(() => {
  if (!currentTypeConfig.value.imageUrl) return {}
  return {
    backgroundImage: `url('${currentTypeConfig.value.imageUrl}')`,
  }
})

function onImgError(e) {
  // ì´ë¯¸ì§€ ê¹¨ì§ˆ ë•Œ ëŒ€ì²´ ì²˜ë¦¬
  e.target.style.display = 'none'
}

const currentTypeConfig = computed(() => {
  if (!props.farm || !props.farm.farmType) return DEFAULT_TYPE_CONFIG;

  const typeKey = props.farm.farmType;
  const config = TYPE_DEFINITIONS[typeKey];

  if (typeof config === 'string') {
    // Aliasì¸ ê²½ìš° (ì˜ˆ: 'íš¨ìœ¨í˜• ë†ì¥' -> 'Efficiency-Oriented' -> ê°ì²´)
    return TYPE_DEFINITIONS[config] || DEFAULT_TYPE_CONFIG;
  }
  
  return config || DEFAULT_TYPE_CONFIG;
});
</script>